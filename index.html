<html style="min-height:925px">
<head>
    <meta charset="utf-8">
    <title>Dance Commander</title>
    <script src="https://use.fonticons.com/5b94a10f.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href='http://fonts.googleapis.com/css?family=Merriweather+Sans:400,800' rel='stylesheet' type='text/css'>
    
    <script src="/snap.svg.js"></script>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
</head>

<body class="pink">
    <span id="rain" class="topLeft"><i class="icon icon-umbrella icon-3x"></i></span>
    <span id="share" class="topRight"><i class="icon icon-bullhorn icon-3x"></i></span>
    <span id="magic" class="bottomLeft"><i class="icon icon-magic icon-3x"></i></span>
    <span id="viral" class="bottomRight"><i class="icon icon-bar-chart icon-3x"></i></span>
    <div id="info">
        <div id="site" class="pinkText">DanceCommander.rocks</div>
    </div>
    </div>
    <div style="margin:0 auto; width:100%; height:100%">
<svg id="dude" width="100%" height="100%" viewBox="0 0 130 131" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <g id="dudeGroup" transform="translate(50,25)">
    <path d="M17.3808132,13.882286 L18.6078132,13.882286 C23.2839307,13.882286 21.7108134,19.1065868 21.7108134,28.4562863 C21.7108134,37.8059858 21.7108132,39.938286 21.7108132,39.938286 L21.7108134,48.6266059 C21.7108134,51.1871527 15.3958132,50.453286 15.3958132,50.453286 C15.2968132,49.568286 14.2598132,49.576286 14.1638132,50.453286 C14.1638132,50.453286 7.7758132,51.2369574 7.7758132,48.6266059 L7.77581321,40.048286 C7.77581321,40.048286 7.77581321,37.7981726 7.77581321,28.456286 C7.7758132,19.1143993 5.92481321,13.882286 10.8718132,13.882286 L12.0978132,13.882286 L17.3808132,13.882286 Z" id="body" sketch:type="MSShapeGroup"></path>
    <path d="M14.3044778,49.453286 L11.3256836,77.2592778 C10.8176836,81.7112778 4.42412891,80.6317114 4.93212891,76.1787114 L7.76806641,47.0522461 C8.46826172,43.9023433 15.3122899,46.4736328 14.3044778,49.453286 Z" id="leftLeg" sketch:type="MSShapeGroup"></path>
    <path d="M15.2489866,49.453286 L18.2277808,77.2592778 C18.7357808,81.7112778 25.1293356,80.6317114 24.6213356,76.1787114 C24.6213356,76.1787114 21.5832032,47.1025391 21.7832032,47.1025391 C21.0830079,43.9526363 14.2411746,46.4736328 15.2489866,49.453286 L15.2489866,49.453286 Z" id="rightLeg" sketch:type="MSShapeGroup"></path>
    <path d="M9.39697266,16.6362304 L4.92580194,41.252 C4.32980194,45.351 -0.895198061,44.376 0.133801939,39.976 L4.92580175,16.6362305 C4.92580175,13.8396329 10.1982422,12.1814296 9.39697266,16.6362304 Z" id="leftArm" sketch:type="MSShapeGroup"></path>
    <path d="M19.9930063,16.6362304 L24.464177,41.252 C25.060177,45.351 30.285177,44.376 29.256177,39.976 L24.4641772,16.6362305 C24.4641772,13.8396329 19.1917367,12.1814296 19.9930063,16.6362304 L19.9930063,16.6362304 Z" id="rightArm" sketch:type="MSShapeGroup"></path>
    <path d="M14.701,0 C17.669,0 20.075,2.405 20.075,5.373 C20.075,8.341 17.669,10.747 14.701,10.747 C11.733,10.747 9.327,8.341 9.327,5.373 C9.327,2.405 11.733,0 14.701,0 L14.701,0 Z" id="head" sketch:type="MSShapeGroup"></path>
    </g>
</svg>
    </div>

    <script type="text/javascript">
    $().ready(function(){

        var isRaining = false;
        var checkForRain = function() {
            $.ajax({
                url : "http://api.wunderground.com/api/1e8f872abcf6164d/conditions/q/pws:KCASANFR97.json",
                dataType : "jsonp",
                success : function(parsed_json) {
                    var pressure_trend = parsed_json['current_observation']['pressure_trend'];
                    console.log("pressure trend:", pressure_trend)
                    if (pressure_trend == "-") {
                        if (!isRaining){    
                            isRaining = true;
                            console.log("rain dance!");
                            transition(rainDance);
                        }
                    } else {
                        if (isRaining) {
                            isRaining = false;
                            transition(raiseRoof);
                        }
                        console.log("keep dancing");
                    }
                }
            });
        }
        
        setInterval(checkForRain, 10 * 60 * 1000);

        // var s = Snap();
        var dude = Snap.select("#dude"),
            head = dude.select("#head"),
            body = dude.select("#body"),
            leftArm = dude.select("#leftArm"),
            rightArm = dude.select("#rightArm"),
            leftLeg = dude.select("#leftLeg"),
            rightLeg = dude.select("#rightLeg"),
            timer;
        var pivots = [
                [44, 147],
                [92, 126]
            ];

        // leftArm.animate({
        //                 transform: "r120 8.5 16.8"
        //             }, 200);
        timer = setTimeout(function () {
                    // console.log('fired');
                    // leftArm.animate({
                    //     transform: "r120 8.5 16.8"
                    // }, 200);
                    makeSomeNoise();
                }, 500);

        // 9.479 13.882
        // "r120 8.5 16.8"
        // 19.91 13.882
        var doAnimation = true;
        var leftArmCenter = "8.5 16.8";
        var rightArmCenter = "20.9 16.8";
        var makeSomeNoise = function() {
            if (!doAnimation) {
                rightArm.animate({transform:""}, 100);
                leftArm.animate({transform:""}, 100);
                doAnimation = true;
                return;
            }
            rightArm.animate({transform: "r-120 " + rightArmCenter}, 300);
            leftArm.animate(
                {transform: "r120 " + leftArmCenter}, 
                300,
                function(){
                    rightArm.animate({transform: "r-60 " + rightArmCenter}, 300);
                    leftArm.animate(
                        {transform: "r60 " + leftArmCenter}, 
                        300,
                        makeSomeNoise
                    );
                }
            );
        }

        var waveHands = function() {
            if (!doAnimation) {
                rightArm.animate({transform:""}, 100);
                leftArm.animate({transform:""}, 100);
                doAnimation = true;
                return;
            }
            rightArm.animate({transform: "r-160 " + rightArmCenter}, 300);
            leftArm.animate(
                {transform: "r60 " + leftArmCenter}, 
                300,
                function(){
                    rightArm.animate({transform: "r-60 " + rightArmCenter}, 300);
                    leftArm.animate(
                        {transform: "r160 " + leftArmCenter}, 
                        300,
                        waveHands
                    );
                }
            );
        }

        var setupRoof = true;
        var raiseRoof = function() {
            if (!doAnimation) {
                rightArm.animate({transform:""}, 100);
                leftArm.animate({transform:""}, 100);
                doAnimation = true;
                return;
            }
            if (setupRoof) {
                rightArm.animate({transform:"r-160 " + rightArmCenter}, 100);
                leftArm.animate(
                    {transform:"r160 " + leftArmCenter}, 
                    100,
                    function(){
                        setupRoof = false;
                        raiseRoof();
                    }
                );
                // return;
            }
            rightArm.animate({transform: "r-160 " + rightArmCenter + " t0 4"}, 300);
            leftArm.animate(
                {transform: "r160 " + leftArmCenter + " t0 4"}, 
                300,
                function(){
                    rightArm.animate({transform: "r-160 " + rightArmCenter + " t0 -2"}, 300);
                    leftArm.animate(
                        {transform: "r160 " + leftArmCenter + " t0 -2"}, 
                        300,
                        raiseRoof
                    );
                }
            );
        }

        var shoulderBounce = function() {
            if (!doAnimation) {
                rightArm.animate({transform:""}, 100);
                leftArm.animate({transform:""}, 100);
                doAnimation = true;
                return;
            }
            rightArm.animate({transform: "t0 4"}, 300);
            leftArm.animate(
                {transform: "t0 4"}, 
                300,
                function(){
                    rightArm.animate({transform: ""}, 300);
                    leftArm.animate(
                        {transform: ""}, 
                        300,
                        shoulderBounce
                    );
                }
            );
        }

        var setupRain = true;
        var rainDance = function() {
            if (!doAnimation) {
                rightArm.animate({transform:""}, 100);
                leftArm.animate({transform:""}, 100);
                rightLeg.animate({transform:""}, 100);
                leftLeg.animate({transform:""}, 100);
                doAnimation = true;
                return;
            }
            if (setupRain) {
                rightArm.animate({transform:"r-160 " + rightArmCenter}, 100);
                leftArm.animate(
                    {transform:"r160 " + leftArmCenter}, 
                    100,
                    function(){
                        setupRain = false;
                        rainDance();
                    }
                );
                return;
            }

            rightArm.animate({transform: "r-160 " + rightArmCenter + " t0 4"}, 300);
            leftLeg.animate({transform: ""}, 300);
            rightLeg.animate({transform: "t0 -6"}, 300);
            leftArm.animate(
                {transform: "r160 " + leftArmCenter + "t0 0"}, 
                300,
                function(){
                    rightArm.animate({transform: "r-160 " + rightArmCenter + " t0 0"}, 300);
                    leftLeg.animate({transform:"t0 -6"}, 300);
                    rightLeg.animate({transform:""}, 300);
                    leftArm.animate(
                        {transform: "r160 " + leftArmCenter + " t0 4"}, 
                        300,
                        rainDance
                    );
                }
            );
        }

        var transition = function(dance) {
            stopDancing();
            setTimeout(function(){
                dance();
            }, 250);
        }

        $("#rain").click(function(){
            isRaining = !isRaining;
            if (isRaining) {
                transition(rainDance);    
            } else {
                transition(raiseRoof);
            }
        });


        $("#info").click(function(){
            $("#dude").show();
            $("#info").hide();
        })
        $("#share").click(function(){
            $("#dude").hide();
            $("#info").show();
        })

        var stopDancing = function() {
            doAnimation = false;
        }
    });
    </script>
</body>

</html>
